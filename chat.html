<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="panelistic3.0-electron.css">
	<script src="panelistic3.0-electron.js"></script>
	<script src="func.js"></script>
	<title>在线答疑</title>
	<style type="text/css"></style>
	<link href="maticons.css" rel="stylesheet">
	<style type="text/css">
	.panelistic_sidebar_selection {
		padding: 15px;
	}
	</style>
	<script>
		let panelistic;
		window.onload = function() {
			panelistic = new Panelistic();
			panelistic.initialize();

			getImgroups()

			document.getElementById('webview').addEventListener('ipc-message', (event) => {
				if (event.channel=="okay") {
					panelistic.dialog.alert("提示","操作成功完成","确定",()=>{window.location.reload()})
				}
			})
		}

		function model_imgroup(groupname,groupguid) {
			return `<div class="panelistic_sidebar_selection" onclick="delIm('${groupguid}')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;vertical-align: middle;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;${groupname}</span></div>`
		}

		function getImgroups() {
			simpleRequest("https://"+getGlobalServerAddr()+"/restfuldatasource/imgroups/users/?redirect=1&type=1&userguid="+getGlobalUserguid(),'',[{ key: 'Set-Cookie', value: 'sessionid=' + getGlobalSessionId() + ';szUserGUID=' + getGlobalUserguid() + ';szUserName=' + globalAccountFile.account }],(data)=>{
				let retdata = JSON.parse(data)
				let allstr=""
				for (var i = 0; i < retdata.length; i++) {
					allstr += model_imgroup(retdata[i].name,retdata[i].guid);
				}
				document.getElementById('sectionup').insertAdjacentHTML("beforeend", allstr)
			},(err)=>{
				console.log(err)
				panelistic.dialog.alert("提示","刷新列表出错，请检查网络后重试","确定")
			},8000,true)
		}

		function delIm(imguid) {
			panelistic.dialog.confirm("删除讨论组","确定要删除讨论组吗？","确定","取消",(result)=>{
				if (result) {
					panelistic.dialog.confirm("再次确认","<span style='color:red;font-weight:bold;'>警告！您正在删除讨论组！操作记录将在后台可见！确定继续吗</span>","确定","取消",(result2)=>{
						if (result2) {
							yesDelIm(imguid);
						}
					})
				}
			})
		}

		function yesDelIm(imguid) {
			simpleRequestDel('https://'+getGlobalServerAddr()+'/restfuldatasource/imgroups/'+imguid+'.json','',[{ key: 'Set-Cookie', value: 'sessionid=' + getGlobalSessionId() + ';szUserGUID=' + getGlobalUserguid() + ';szUserName=' + globalAccountFile.account }],()=>{
				panelistic.dialog.alert("提示","删除成功","确定",()=>{window.location.reload()})
			},()=>{panelistic.dialog.alert("提示","删除失败","确定")},2000);
		}
	</script>
</head>

<body>
	<div id="panelistic_window" ondragstart="return false;">
		<div id="panelistic_blur"></div>
		<div id="panelistic_content">
			<div id="panelistic_sidebar" style="top: 0px;height: 100%">
				<div id="sectionup" style="scroll-behavior: auto;overflow: auto;height: calc(100% - 54px)" id="alllists">
					<!-- <div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div>
					<div id="select1" class="panelistic_sidebar_selection" onclick="webview.loadURL(__dirname+'/selflearn.html')"><span style="vertical-align: middle;display: inline-block;"><img src="src/img/ic_placehold.jpg" style="height: 25px;"></span><span style="display: inline-block;vertical-align: middle;">&nbsp;平板老师1</span></div> -->
				</div>
				<div style="background-color:#fff8"><input type="button" value="创建讨论组" style="margin:8px"></div>
			</div>
			<div id="panelistic_content_sidebar">
				<webview id="webview" src="seluser.html" nodeintegration="true" disablewebsecurity webpreferences="contextIsolation=no" />
				</webview>
			</div>
		</div>
	</div>
</body>

</html>