<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="panelistic3.0-electron.css">
	<script src="panelistic3.0-electron.js"></script>
	<title>title</title>
	<style type="text/css"></style>
	<script type="text/javascript">
	const $ = require('jquery');
	let panelistic;
	const fs = require('fs')
	const electron = require("electron");
	let fulldata = JSON.parse(fs.readFileSync(__dirname + "/resources"));
	Date.prototype.Format = function(fmt) {
		var o = {
			"M+": this.getMonth() + 1,
			"d+": this.getDate(),
			"h+": this.getHours(),
			"m+": this.getMinutes(),
			"s+": this.getSeconds(),
			"q+": Math.floor((this.getMonth() + 3) / 3),
			"S": this.getMilliseconds()
		};
		if (/(y+)/.test(fmt))
			fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
		for (var k in o)
			if (new RegExp("(" + k + ")").test(fmt))
				fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ?
					(o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
		return fmt;
	}
	window.onload = function() {
		panelistic = new Panelistic();
		panelistic.initialize();
		document.getElementById('lastSyncTime').innerText = new Date(fs.statSync(__dirname + '/resources').ctime).Format('MM月dd日 hh:mm:ss');
	}
	const remote = require("@electron/remote");

	function cutString(str, len) {
		if (str.length * 2 <= len) {
			return str;
		}
		var strlen = 0;
		var s = "";
		for (var i = 0; i < str.length; i++) {
			s = s + str.charAt(i);
			if (str.charCodeAt(i) > 128) {
				strlen = strlen + 2;
				if (strlen >= len) {
					return s.substring(0, s.length - 1) + "...";
				}
			} else {
				strlen = strlen + 1;
				if (strlen >= len) {
					return s.substring(0, s.length - 2) + "...";
				}
			}
		}
		return s;
	}

	function requestSync(pos, body) {
		return $.ajax({
			url: "https://gzzx.lexuewang.cn:8003/wmexam/wmstudyservice.WSDL",
			data: body,
			dataType: "text",
			type: "post",
			async: false,
			xhrFields: {
				withCredentials: true
			},
			beforeSend: function(request) {
				let ck = `sessionid=${globalSsid};userguid=ffffffffffffffffffffffffffffffff`;
				request.setRequestHeader("Set-Cookie", ck);
				request.setRequestHeader("SOAPAction", pos);
			}
		})
	}

	let renderredDate;

	function renderPage(gotdatas) {

	}

	function getDigital(num) {
		return Number(num.match(/\d+/g).join(''));
	}

	function isBetween(x, a, b) {
		if ((x >= a && x <= b) || (x <= a && x >= b)) {
			return true;
		} else {
			return false
		}
	}

	let recordCount = 0;

	function readRecord(amount) {
		let retv = []
		let finalCnt = recordCount + amount;
		for (; recordCount < finalCnt; recordCount++) {
			try {
				if (fulldata[recordCount].error != 1) {
					retv.push(fulldata[recordCount]);
				}
			} catch {}
		}
		return retv;
	}

	function getDateContent(dateStartNum, dateEndNum) {
		let retv = []
		for (var i = 0; i < fulldata.length; i++) {
			//console.log(getDigital(fulldata[i]["date"]))
			if (isBetween(getDigital(fulldata[i]["date"]), dateStartNum, dateEndNum)) {
				//console.log(fulldata[i].date,fulldata[i]);
				retv.push(fulldata[i]);
			}
		}
		return retv;
	}

	//M
	function model_dayStart(date) {
		return `<span class="panelistic_placeholder"></span>
		<div class="panelistic_panel">
			<div class="panelistic_panel_name">${date}</div><br><span class="panelistic_placeholder_large"></span>`
	}

	function model_subjectStart(subject) {
		return `<div class="panelistic_panel" style="padding-bottom: 3px;">
				<div class="panelistic_panel_name" style="background-color: #ff555588;">${subject}</div><br><span class="panelistic_placeholder_large"></span>`
	}

	function model_file(title, author, viewdate, startdate, guid) {
		return `<img src="https://gzzx.lexuewang.cn:8003/getresourcethumbnail?guid=e672d98393a14057ad8f7ed4bf1fc14c" style="display:inline;" height="80px" width="80px">
				<div style="vertical-align: top;display: inline-block;margin-left: 5px;width: 350px;height: 80px;">
					<span style="vertical-align: top;font-size: 18px;font-weight: bold;">${title}</span>
					<!--max-length-35chars-->
					<span style="font-size: 13px;color: #555;display: block;">发布者 ${author}</span>
					<span style="font-size: 13px;color: #555;display: block;">访问时间 ${viewdate}</span>
					<span style="font-size: 13px;color: #555;display: block;">发布时间 ${startdate}</span>
				</div>
				<div style="vertical-align: top;display: inline-block;margin-left: 5px;">
					<input type="button" value="打开文件" style="width: 95px;" onclick="loadData('${guid}','open')">
					<span class="panelistic_placeholder" style="height: 5px;"></span>
					<input type="button" value="另存为..." style="width: 95px;" onclick="loadData('${guid}','saveas')">
				</div>`
	}

	function model_subjectEnd() {
		return `			</div>`
	}

	function model_dayEnd() {
		return `</div>`
	}

	</script>
</head>

<body>
	<div id="panelistic_content_sidebar_in">
		<h1>自主学习</h1>
		<h6>最近一次同步时间：<span id="lastSyncTime"></span></h6>
	</div>
	</div>
</body>

</html>
